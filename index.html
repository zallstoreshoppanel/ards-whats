<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ARD GRUP WA Clone Responsive</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,Arial,sans-serif;}
html,body{height:100%;width:100%;overflow:hidden;}
body{display:flex;flex-direction:column;background:#000;color:#fff;}
header{height:60px;background:#075e54;color:#fff;display:flex;align-items:center;padding:0 10px;justify-content:space-between;}
header .left{display:flex;align-items:center;gap:10px;}
header .backBtn{font-size:22px;cursor:pointer;display:none;}
header .title{font-weight:bold;font-size:18px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
header .right{display:flex;align-items:center;gap:15px;font-size:20px;cursor:pointer;}
main{flex:1;display:flex;flex-direction:column;position:relative;min-height:0;}
.page{position:absolute;top:0;left:0;width:100%;height:100%;overflow-y:auto;display:none;flex-direction:column;transition:0.3s;}
.page.active{display:flex;flex-direction:column;}
#chatList{flex-direction:column;padding:10px;overflow-y:auto;}
.chatItem{padding:20px 25px;min-height:70px;background:#1e1e1e;margin:8px 0;border-radius:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-size:17px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
#chatContainer{flex:1;padding:10px;display:flex;flex-direction:column;gap:8px;overflow-y:auto;}
.message{max-width:70%;padding:10px 14px;border-radius:20px;font-size:15px;display:flex;flex-direction:column;gap:3px;word-wrap:break-word;position:relative;}
.own{background:#25d366;align-self:flex-end;border-bottom-right-radius:0;color:#000;}
.other{background:#1e1e1e;align-self:flex-start;border-bottom-left-radius:0;color:#fff;}
.timestamp{font-size:11px;color:gray;align-self:flex-end;margin-top:3px;}
#inputContainer{display:flex;padding:10px;background:#111;gap:5px;align-items:center;flex-shrink:0;position:relative;border-radius:25px;margin:5px;}
#replyPreview{background:#333;padding:5px 10px;border-radius:10px;margin-bottom:5px;display:none;position:absolute;bottom:50px;left:10px;font-size:13px;align-items:center;display:flex;z-index:10;}
#cancelReply{position:absolute;right:5px;top:2px;cursor:pointer;color:red;font-weight:bold;}
#messageInput{flex:1;padding:12px;border-radius:25px;border:1px solid #ccc;outline:none;font-size:14px;background:#222;color:#fff;}
#sendBtn,#emojiBtn{padding:12px;border-radius:50%;border:none;cursor:pointer;font-size:16px;}
#sendBtn{background:#25d366;color:#000;}
#emojiBtn{background:#ffcc00;color:#000;}
#emojiPicker{display:none;position:absolute;bottom:60px;background:#fff;border:1px solid #ccc;border-radius:10px;padding:5px;max-width:250px;flex-wrap:wrap;gap:5px;display:flex;}
#emojiPicker span{cursor:pointer;font-size:20px;}
#bottomNav{height:60px;background:#075e54;display:flex;justify-content:space-around;align-items:center;color:#fff;flex-shrink:0;}
#bottomNav div{flex:1;text-align:center;cursor:pointer;font-size:14px;}
#bottomNav div.active{border-top:3px solid #fff;}
#statusList{flex-direction:column;padding:10px;overflow-y:auto;display:flex;gap:10px;color:#fff;}
.statusBubble{background:#222;padding:12px;border-radius:12px;cursor:pointer;position:relative;display:flex;flex-direction:column;gap:5px;box-shadow:0 2px 5px rgba(0,0,0,0.2);}
.statusViewer{font-size:12px;color:gray;margin-top:5px;}
#usernameModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:999;}
#usernameModal .modalContent{background:#fff;padding:20px;border-radius:12px;display:flex;flex-direction:column;gap:10px;width:80%;max-width:300px;}
#usernameModal input{padding:10px;border-radius:5px;border:1px solid #ccc;}
#usernameModal button{padding:10px;border-radius:5px;border:none;background:#25d366;color:#fff;cursor:pointer;}
#statusPopup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:9999;}
#statusPopup img{max-width:90%;max-height:90%;border-radius:10px;}
/* Modern popup */
#popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#111;padding:15px;border-radius:12px;color:#fff;z-index:9999;min-width:200px;text-align:center;}
#popupClose{margin-top:10px;padding:5px 10px;border:none;border-radius:5px;background:#25d366;color:#000;cursor:pointer;}
@media(max-width:480px){#messageInput{font-size:12px;padding:10px;}#sendBtn,#emojiBtn{padding:10px;font-size:14px;}.chatItem{font-size:15px;padding:15px;min-height:60px;}header .title{font-size:16px;}#bottomNav div{font-size:12px;}}
</style>
</head>
<body>

<div id="usernameModal">
  <div class="modalContent">
    <h3>Masukkan Username</h3>
    <input type="text" id="usernameInput" placeholder="Username..."/>
    <button id="usernameBtn">Lanjut</button>
  </div>
</div>

<header>
  <div class="left">
    <div class="backBtn" id="backBtn">‚Üê</div>
    <div class="title" id="headerTitle">Chats</div>
  </div>
  <div class="right">
    <div id="wallpaperBtn">‚ãÆ</div>
    <div id="statusBtn">üìù</div>
  </div>
</header>

<main>
  <div class="page active" id="chatList">
    <div class="chatItem" data-chat="ARD_GRUP">ARD GRUP</div>
  </div>
  <div class="page" id="chatRoom">
    <div id="chatContainer"></div>
    <div id="inputContainer">
      <div id="replyPreview">
        <span id="replyUser"></span>: <span id="replyText"></span>
        <span id="cancelReply">‚úñ</span>
      </div>
      <input type="text" id="messageInput" placeholder="Ketik pesan..." />
      <button id="emojiBtn">üòä</button>
      <button id="sendBtn">‚û§</button>
      <div id="emojiPicker"></div>
    </div>
  </div>
  <div class="page" id="statusPage">
    <div style="display:flex;align-items:center;gap:5px;padding:10px;">
      <input type="text" id="statusInput" placeholder="Buat status text atau masukkan URL gambar..." style="flex:1;padding:8px;border-radius:20px;border:1px solid #ccc;">
      <button id="sendStatus" style="padding:8px 12px;border-radius:20px;border:none;background:#25d366;color:#000;cursor:pointer;">‚û§</button>
    </div>
    <div id="statusList"><span>Belum ada status</span></div>
  </div>
</main>

<div id="bottomNav">
  <div class="navItem active" data-page="chatList">Chat</div>
  <div class="navItem" data-page="statusPage">Status</div>
</div>

<div id="statusPopup"><img src="" id="popupImg"/></div>

<div id="popup">
  <div id="popupText"></div>
  <button id="popupClose">Tutup</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, off } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyBqcIqL4sJzzFYCMsDswyoL0XwxTkYi-Mc",
  authDomain:"yerter-1bbf4.firebaseapp.com",
  projectId:"yerter-1bbf4",
  storageBucket:"yerter-1bbf4.appspot.com",
  messagingSenderId:"9888123434",
  appId:"1:9888123434:web:8f79d1d3f16f92fad21153"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let username = localStorage.getItem("username");
const usernameModal = document.getElementById('usernameModal');
const usernameInput = document.getElementById('usernameInput');
const usernameBtn = document.getElementById('usernameBtn');
if(!username) usernameModal.style.display='flex'; else usernameModal.style.display='none';

usernameBtn.addEventListener('click',()=>{
  const val = usernameInput.value.trim();
  if(val.length>0){
    username = val;
    localStorage.setItem("username", username);
    usernameModal.style.display='none';
  }
});

const chatListPage = document.getElementById('chatList');
const chatRoomPage = document.getElementById('chatRoom');
const chatContainer = document.getElementById('chatContainer');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const replyPreview = document.getElementById('replyPreview');
const replyUser = document.getElementById('replyUser');
const replyText = document.getElementById('replyText');
const cancelReply = document.getElementById('cancelReply');
const emojiBtn = document.getElementById('emojiBtn');
const emojiPicker = document.getElementById('emojiPicker');
const navItems = document.querySelectorAll('.navItem');
const backBtn = document.getElementById('backBtn');
const headerTitle = document.getElementById('headerTitle');
const statusInput = document.getElementById('statusInput');
const sendStatus = document.getElementById('sendStatus');
const statusList = document.getElementById('statusList');
const bottomNav = document.getElementById('bottomNav');
const wallpaperBtn = document.getElementById('wallpaperBtn');

const popup = document.getElementById('popup');
const popupText = document.getElementById('popupText');
const popupClose = document.getElementById('popupClose');

let replyTo = null;
let currentChat = null;
let chatListener = null;

popupClose.addEventListener('click', ()=>{ popup.style.display='none'; });

// Emoji setup
const emojis = ["üòÄ","üòÇ","üòç","üòé","üò¢","üëç","üôè","üéâ","‚ù§Ô∏è","üî•"];
emojiPicker.innerHTML = emojis.map(e=>`<span>${e}</span>`).join('');
emojiPicker.querySelectorAll('span').forEach(span=>{
  span.addEventListener('click', ()=>{
    messageInput.value += span.textContent;
    emojiPicker.style.display='none';
    messageInput.focus();
  });
});
emojiBtn.addEventListener('click', ()=>emojiPicker.style.display = emojiPicker.style.display==='flex'?'none':'flex');

// Bottom nav
navItems.forEach(nav=>{
  nav.addEventListener('click', ()=>{
    navItems.forEach(n=>n.classList.remove('active'));
    nav.classList.add('active');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(nav.dataset.page).classList.add('active');
    backBtn.style.display = (nav.dataset.page==='chatRoom')?'block':'none';
    bottomNav.style.display = (nav.dataset.page==='chatRoom')?'none':'flex';
    headerTitle.textContent = nav.dataset.page==='chatRoom'?'ARD GRUP':nav.textContent;
  });
});

// Back button
backBtn.addEventListener('click', ()=>{
  chatRoomPage.classList.remove('active');
  chatListPage.classList.add('active');
  headerTitle.textContent='Chats';
  backBtn.style.display='none';
  bottomNav.style.display='flex';
});

// Masuk chat
document.querySelector('.chatItem').addEventListener('click', ()=>{
  currentChat='ARD_GRUP';
  chatListPage.classList.remove('active');
  chatRoomPage.classList.add('active');
  headerTitle.textContent='ARD GRUP';
  backBtn.style.display='block';
  bottomNav.style.display='none';

  const wallpaper = localStorage.getItem('chatWallpaper_'+currentChat);
  chatRoomPage.style.background = wallpaper?`url(${wallpaper}) center/cover no-repeat`:'#000';

  loadChat();
});

// Cancel reply
cancelReply.addEventListener('click', ()=>{
  replyTo = null;
  replyPreview.style.display='none';
});

// Send message
sendBtn.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', e=>{
  if(e.key==='Enter'){ e.preventDefault(); sendMessage(); }
});

function sendMessage(){
  const text = messageInput.value.trim();
  if(!text || !currentChat) return;
  push(ref(db,'chats/'+currentChat),{
    username,
    text,
    timestamp: Date.now(),
    replyUsername: replyTo?replyTo.username:'',
    replyText: replyTo?replyTo.text:''
  });
  messageInput.value='';
  replyTo=null;
  replyPreview.style.display='none';
}

// Load chat with safe listener
function loadChat(){
  if(!currentChat) return;
  chatContainer.innerHTML='';
  // Hapus listener lama jika ada
  if(chatListener) off(ref(db,'chats/'+currentChat), 'child_added', chatListener);
  const chatRef = ref(db,'chats/'+currentChat);
  chatListener = onChildAdded(chatRef, snapshot=>{
    const data = snapshot.val();
    if(!data) return;
    const div = document.createElement('div');
    div.classList.add('message', data.username===username?'own':'other');

    let content = '';
    if(data.replyText){
      content += `<div style="background:#333;padding:5px 10px;border-radius:10px;margin-bottom:5px;font-size:13px;">
      ‚Ü™ ${data.replyUsername}: ${data.replyText.length>50?data.replyText.slice(0,50)+'...':data.replyText}</div>`;
    }
    content += `<div>${data.text}</div>`;
    content += `<span class="timestamp">${new Date(data.timestamp).toLocaleTimeString()}</span>`;
    div.innerHTML = `<strong>${data.username}:</strong> ${content}`;

    div.addEventListener('dblclick', ()=>{
      replyTo = {username:data.username,text:data.text};
      replyUser.textContent = data.username;
      replyText.textContent = data.text;
      replyPreview.style.display='flex';
      messageInput.focus();
    });

    chatContainer.appendChild(div);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  });
}

// Status
sendStatus.addEventListener('click', ()=>{
  const val = statusInput.value.trim();
  if(!val) return;
  push(ref(db,'status/'),{
    username,
    text: val,
    timestamp: Date.now()
  });
  statusInput.value='';
});

// Load status realtime
const statusRef = ref(db,'status/');
statusList.innerHTML='<span>Belum ada status</span>';
onChildAdded(statusRef, snapshot=>{
  const data = snapshot.val();
  if(!data) return;
  const defaultSpan = statusList.querySelector('span');
  if(defaultSpan) defaultSpan.remove();
  const div = document.createElement('div');
  div.classList.add('statusBubble');
  div.innerHTML = `<strong>${data.username}</strong><div>${data.text}</div><span class="timestamp">${new Date(data.timestamp).toLocaleTimeString()}</span>`;
  div.addEventListener('click', ()=>{
    popupText.innerHTML = `<strong>${data.username}</strong>: ${data.text}`;
    popup.style.display='flex';
  });
  statusList.appendChild(div);
});

// Wallpaper chat room
wallpaperBtn.addEventListener('click', ()=>{
  if(!currentChat) return;
  const fileInput = document.createElement('input');
  fileInput.type='file';
  fileInput.accept='image/*';
  fileInput.click();
  fileInput.addEventListener('change', ()=>{
    const file = fileInput.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = (e)=>{
        chatRoomPage.style.background = `url(${e.target.result}) center/cover no-repeat`;
        localStorage.setItem('chatWallpaper_'+currentChat, e.target.result);
      };
      reader.readAsDataURL(file);
    }
  });
});
</script>
</body>
                                                             </html>
